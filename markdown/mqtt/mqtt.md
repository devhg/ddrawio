* 低协议开销。MQTT的独特之处在于，它的每消息标题可以短至2个字节。对于 HTTP，为每个新请求消息重新建立HTTP连接会导致重大的开销。MQ 和 MQTT 所使用的永久连接显著减少了这一开销。
* 对不稳定网络的容忍。MQTT和MQ能够从断开等故障中恢复，而且没有进一步的代码需求。但是，HTTP 无法原生地实现此目的，需要客户端重试编码，这可能增加幂等性问题。
* 低功耗。MQTT是专门针对低功耗目标而设计的。HTTP 的设计没有考虑此因素，因此增加了功耗。
* 数百万个连接的客户端。在HTTP堆栈上，维护数百万个并发连接，需要做许多的工作来提供支持。IBM 提供了一个单机架装载服务器，经过测试能处理多达 100 万个通过 MQTT 并发连接的设备。相反，MQ 不是为大量并发客户端而设计的。
* 推送通知。您需要能够及时地将通知传递给客户。为此，必须采用某种定期轮询或推送方法；从电池、系统负载和带宽角度讲，推送是最佳解决方案。我们的企业可能需要在没有第三方中介的情况下发送敏感的信息。这降低了特定于操作系统的解决方案（比如 Apple iOS、Google Play 通知）作为主要传输机制的价值。
* 客户端平台差异。HTTP和MQTT客户端都已在大量平台上实现。MQTT的简单性有助于以极少的精力在额外的客户端上实现 MQTT。
* 防火墙容错。事实上，MQTT的应用非常之广泛，几乎现在随便找一家大型的硬件、互联网企业，都可以找到MQTT的身影。









因为初始阶段对于IoT MQ并不是很了解，也从未涉及过物联网领域，所以初步从两个方面考虑：功能方面与系统方面。

功能层面。该IoT MQ应该能对接入的客户端进行管理，包括统计，监控流量，强制下线，数据传输等。能对集群或者单broker主机进行监控等。该IoT MQ应该能将数据进行传播存储，主要是通过桥接Kafka等上行到其它存储平台进行数据分析等



系统层面。服务高可用，不能有单点故障等问题，所以该IoT MQ最好能集群部署，数据必须有一定可靠性，不能出现数据大量丢失的情况。

1. 高连接高请求：也就是高性能，不过要求单机（4c16g）要支持十万级以上的连接，并且消息TPS要高，同时支持低延时、
2. 高可扩展性：架构总是演进的，需求也一直在变，才开始的IoT MQ的设计只满足了最低的需求，所以必须要是高可扩展性的，例如可桥接其它数据平台等
3. 安全：物联网一定是公网的，所以需要考虑传输加密以及权限验证等安全，要实现TLS/SSL以及权限验证等
4. 规模：初始规模一般预估为真实需求的2到5倍，我们初始评估长连接设备数20W，消息大小为200byte的消息的TPS至少达到10000，响应时间在100ms内
5. 成本：集群部署为了节省主机成本所以单机性能有一定要求，人员方面技能储备以java为主



### 开源or自研

在对功能和系统进行分析后，我们有了两种基本的方案：1.基于开源项目二次开发，2.完全自研。我们先看一下选择开源项目的优劣势：



- 开源项目一般已经有人维护，如果社区活跃的也有很多解决方案，技术成本较低，开发者的压力也较低
- 不用重复造轮子，重新走老路，时间成本等也降低了



**劣势：**



- 开源项目一般是针对“通用”的场景，大改起来比较麻烦，特别是设计不好的开源项目
- 开源项目的可靠性，可用性等需要考量，安全，灵活性等也降低了